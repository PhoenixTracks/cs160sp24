<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Career Track Timeline</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/x-icon" href="/images/icon.ico">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
<style>
  :root {
  --nav-font-color: #fff; /* Dusty rose for navigation text, adding a touch of uniqueness */
  --section-border-color: #E2C2B9; /* Soft blush for borders, elegant and subtle */
  --month-bg-color: #f5f3ee; /* Pure white for section backgrounds, clean and classic */
  --profile-border-color: #000; /* Matching the section border for harmony and consistency */
  --plan-bg-color: #25682c; 
  --plan-hover-color: #0f2911; 
  --undo-bg-color: #b4261c;
  --undo-hover-color: #7a1c15;
  --hover-bg-color: #DAA49A; /* Dusty rose for hover states, complements navigation text */
  --modal-bg-color:#F5F3EE;
  }

  [data-theme="dark"] {
    --background-color: #2C3E50;
    --font-color:#F5F3EE;
    --modal-bg-color:#2C3E50;
    --header-bg-color: #34495E;
    --nav-bg-color: #16A085;
    --nav-font-color: #ECF0F1;
    --section-border-color: #7F8C8D;
    --month-bg-color: #34495E;
    --profile-border-color: #BDC3C7;
    --plan-bg-color: #BDC3C7;
    --plan-hover-color: #1ABC9C;
    --undo-bg-color: #4f4949;
    --undo-hover-color: #cf3c3c;
  }

  p {
    font-size: 23px;
    text-align: center;
  }
  h1 {
    text-align: center;
  } 

  .poppins-thin {
  font-family: "Poppins", sans-serif;
  font-weight: 100;
  font-style: normal;
  }

  .poppins-extralight {
    font-family: "Poppins", sans-serif;
    font-weight: 200;
    font-style: normal;
  }

  .poppins-light {
    font-family: "Poppins", sans-serif;
    font-weight: 300;
    font-style: normal;
  }

  .poppins-regular {
    font-family: "Poppins", sans-serif;
    font-weight: 400;
    font-style: normal;
  }

  .poppins-medium {
    font-family: "Poppins", sans-serif;
    font-weight: 500;
    font-style: normal;
  }

  .poppins-semibold {
    font-family: "Poppins", sans-serif;
    font-weight: 600;
    font-style: normal;
  }

  .poppins-bold {
    font-family: "Poppins", sans-serif;
    font-weight: 700;
    font-style: normal;
  }

  .poppins-extrabold {
    font-family: "Poppins", sans-serif;
    font-weight: 800;
    font-style: normal;
  }

  .poppins-black {
    font-family: "Poppins", sans-serif;
    font-weight: 900;
    font-style: normal;
  }

  .poppins-thin-italic {
    font-family: "Poppins", sans-serif;
    font-weight: 100;
    font-style: italic;
  }

  .poppins-extralight-italic {
    font-family: "Poppins", sans-serif;
    font-weight: 200;
    font-style: italic;
  }

  .poppins-light-italic {
    font-family: "Poppins", sans-serif;
    font-weight: 300;
    font-style: italic;
  }

  .poppins-regular-italic {
    font-family: "Poppins", sans-serif;
    font-weight: 400;
    font-style: italic;
  }

  .poppins-medium-italic {
    font-family: "Poppins", sans-serif;
    font-weight: 500;
    font-style: italic;
  }

  .poppins-semibold-italic {
    font-family: "Poppins", sans-serif;
    font-weight: 600;
    font-style: italic;
  }

  .poppins-bold-italic {
    font-family: "Poppins", sans-serif;
    font-weight: 700;
    font-style: italic;
  }

  .poppins-extrabold-italic {
    font-family: "Poppins", sans-serif;
    font-weight: 800;
    font-style: italic;
  }

  .poppins-black-italic {
    font-family: "Poppins", sans-serif;
    font-weight: 900;
    font-style: italic;
  }

  /* .active-nav {
    font-weight: bold;
  }
  .mytrack-header {
    display: flex;
    text-align: center;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
  }
  .mytrack-nav {
    list-style-type: none;
    margin-right: 20px;
  }
  .mytrack-nav li {
    display: inline;
    margin-right: 20px;
  }
  .mytrack-nav a {
    color: var(--nav-font-color); 
    background-color: var(--nav-bg-color);
    text-decoration: none; 
    padding: 10px 20px; 
    border-radius: 5px; 
    transition: background-color 0.3s; 
  }
  .mytrack-nav a:hover {
    background-color: var(--hover-bg-color);
  }
  .logo-and-title {
  display: flex;
  align-items: center; 
  } */

  #timelineList, #dedicationForm {
    list-style-type: none;
    padding: 0;
    margin: 20px 0;
  }
  .month-container {
    flex: 1 1 30%;
    max-width: 1500px;
    padding: 20px;
    box-shadow: 0 0.5rem 0.5rem rgba(0,0,0,0.2);
    box-sizing: border-box;
    border: 1px solid var(--profile-border-color);
    background-color: var(--month-bg-color);
    margin-right: 1.5%;  /* horizontal space between containers */
    margin-bottom: 20px;  /* vertical space between containers */
    border-radius: 5px;
  }
  .timeline-row {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: stretch;
  }
  .month-header {
    padding: 10px;
    font-size: 2.5em;
    color: #000;
    margin-bottom: 5px;
    text-align: center;
  }
  .section-header {
    font-weight: 600;
    font-size: 30px;
    list-style-type: none;
    padding-top: 10px;
    padding-bottom: 10px;
    padding-left: 0;
    margin-left: 0;
  }
  .section-list {
    list-style-type: circle;
    margin-left: 30px;
    padding-left: 0;
    font-size: 20px;
  }

  #buttonContainer {
  display: flex;
  justify-content: center; /* Center buttons horizontally */
  align-items: center; /* Center buttons vertically if needed */
  gap: 10px; /* Spacing between buttons */
  }

  button, .plan-button, #undoButton {
    font-family: "Poppins";
    padding: 10px 20px;
    font-size: 20px;
    color: white;
    background-color: var(--plan-bg-color); 
    border-radius: 5px;
    cursor: pointer;
  }

  .plan-button:hover, #undoButton:hover {
    background-color: var(--plan-hover-color); 
  }

  #undoButton {
    background-color: var(--undo-bg-color);
  }

  #undoButton:hover {
    background-color: var(--undo-hover-color); 
  }

  .modal {
    display: none; 
    position: fixed; 
    z-index: 1050; 
    left: 0;
    top: 0;
    width: 100%; 
    height: 100%; 
    overflow: auto; /* Allows scrolling */
  }

  .modal-content {
      position: fixed;
      background-color: #F5F3EE;
      padding: 40px;
      border: 1px solid #000;
      width: 30%; 
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%); /* centers it */
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 20px;
      font-size: 30px;
      text-align: center;
  }
  .loader {
      border: 16px solid #f3f3f3; 
      border-top: 16px solid #E1895D; 
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 2s linear infinite;
  }

  @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
  }

</style>
</head>
<body>

<div class="nav-header">
  <div class="logo-and-title">
    <a href="dashboard"><img src="/images/logo.png" alt="Company Logo" style="height: 100px;"></a>
    <h1>MyTrack Career Timeline</h1>
  </div>
  <ul class="nav">
    <li><a href="dashboard">Dashboard</a></li>
    <li><a href="jobs">Jobs</a></li>
    <li><a href="courses">Courses</a></li>
    <li><a href="mytrack" class="active-nav">MyTrack</a></li>
    <li><a href="profile">Profile</a></li>
    <li><a href="#" onclick="toggleDarkMode()">ðŸŒ™</a></li>
  </ul>
</div>
<div style="padding: 20px" id="timelineDisplay"> 
  <h1>Your Personalized Career Timeline</h1>
  <p>Not sure where to start? Don't worry - we can create a more detailed plan for you!</p>
  <div id="buttonContainer" style="margin-top: 20px;">
    <button class="plan-button" onclick="setDedication()">Generate a More Detailed Plan</button>
    <button id="undoButton" style="display: none;" onclick="undoDetailedPlan()">Undo Detailed Plan</button>
  </div>
  <div id="timelineList" class="timeline-row"></div>
  <!-- this is a loading spinner/circle as we wait for detailedPlan to show up -->
  
  <div class="modal" id="myModal">
    <div class="modal-content">
        <p>Your detailed plan is being generated. Please wait...</p>
        <div class="loader"></div>
    </div>
</div>
  </div>
</div>
</div>

<script>


document.addEventListener("DOMContentLoaded", function() {
    buildTimeline();
    loadDetailedPlans();
});

function loadDetailedPlans() {
    const storedPlans = localStorage.getItem('detailedPlans');
    if (storedPlans) {
        const monthsData = JSON.parse(storedPlans);
        appendDetailedPlan(monthsData);
    }
}

function setInitialTheme() {
  const savedTheme = localStorage.getItem('theme') || 'light';
  document.body.setAttribute('data-theme', savedTheme);
}

function toggleDarkMode() {
  const currentTheme = document.body.getAttribute('data-theme');
  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
  document.body.setAttribute('data-theme', newTheme);
  localStorage.setItem('theme', newTheme);
}

document.addEventListener("DOMContentLoaded", setInitialTheme);
let dailyHours = parseInt(localStorage.getItem('dailyHours')) || 0; 
let selectedItems1 = JSON.parse(localStorage.getItem('selectedItems1')) || [];
let skillTimeFrames = JSON.parse(localStorage.getItem('skillTimeFrames')) || {};
let maxSkillDuration = Math.max(0, ...Object.values(skillTimeFrames));


async function setDedication() {
    showLoad(true); // loading circle shows
    const response = await postData(selectedItems1, skillTimeFrames, dailyHours, maxSkillDuration);
    const monthsData = response.split('^');
    localStorage.setItem('detailedPlans', JSON.stringify(monthsData));
    appendDetailedPlan(monthsData);
    showLoad(false); // loading circle goes away
    
}

async function postData(selectedItems1, skillTimeFrames, dailyHours, maxSkillDuration) {
  // converts skillTimeFrames (js object) -> readable string by GPT when passed in 
  function formatSkillsReadable(skillTimeFrames) {
    let readableString = "";
    let index = 0; 
    for (let skill in skillTimeFrames) {
      if (skillTimeFrames.hasOwnProperty(skill)) { // check if the key is actually a property of the object
        index++;
        readableString += `${index}. Skill: ${skill}, Timeframe: ${skillTimeFrames[skill]}\n`;
      }
    }
    return readableString;
  }

  const readableSkills = formatSkillsReadable(skillTimeFrames);
  // import fetch from 'node-fetch'; // for node.js

  // claude test noggin
  const response = await fetch(
    'https://noggin.rea.gent/criminal-rooster-5479',
    {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: 'Bearer rg_v1_bpuldd2dy138fzuj519iszhurqp93zuhrl1h_ngk',
      },
      body: JSON.stringify({
        // fill variables here.
        "skills": selectedItems1,
        "desiredskills": readableSkills,
        "hours": dailyHours,
        "months": maxSkillDuration,
      }),
    }
  ).then(response => response.text());

  // gpt noggin -> used for demos
  //const response = await fetch(
  //'https://noggin.rea.gent/yelling-sawfish-8024',
  //{
    //method: 'POST',
    //headers: {
      //'Content-Type': 'application/json',
      //Authorization: 'Bearer rg_v1_x9wvoyd5m0mqrmcklv5le44vs6rmwrum6dj7_ngk',
    //},
    //body: JSON.stringify({
      // fill variables here.
      //"skills": selectedItems1,
      //"desiredskills": readableSkills,
      //"hours": dailyHours,
      //"months": maxSkillDuration,
    //}),
  //}
//).then(response => response.text());
    return response;
}

function buildTimeline() {
    const timelineList = document.getElementById("timelineList");
    timelineList.innerHTML = ""; 

    for (let month = 1; month <= maxSkillDuration; month++) {
        
        const monthContainer = document.createElement('div');
        monthContainer.className = 'month-container';
        monthContainer.id = `month-${month}`; 

        const monthHeader = document.createElement('div');
        monthHeader.className = 'month-header';
        monthHeader.textContent = `Month ${month}`;
        monthContainer.appendChild(monthHeader);

        const applyList = document.createElement('ul');
        applyList.className = 'section-list';
        const applyHeader = document.createElement('li');
        applyHeader.className = 'section-header';
        applyHeader.textContent = 'Apply to Jobs Related to these Skills';
        applyList.appendChild(applyHeader);
        
        const takeList = document.createElement('ul');
        takeList.className = 'section-list';
        const takeHeader = document.createElement('li');
        takeHeader.className = 'section-header';
        takeHeader.textContent = 'Take & Continue These Courses';
        takeList.appendChild(takeHeader);

        selectedItems1.forEach(skill => {
            const task = document.createElement('li');
            task.textContent = skill; 
            applyList.appendChild(task); 
        });

        
        for (let skill in skillTimeFrames) {
            const task = document.createElement('li');
            if (month <= skillTimeFrames[skill]) {
                task.textContent = skill; // skill active within this month
                takeList.appendChild(task);
            } else if (skillTimeFrames[skill] > 0) {
                task.textContent = skill;
                applyList.appendChild(task); // skill needs applying after active period
            }
        }

        // appends apply and take lists to the month container if not empty
        if (applyList.children.length > 1) {
            monthContainer.appendChild(applyList);
        }
        if (takeList.children.length > 1) {
            monthContainer.appendChild(takeList);
        }

        // appends the month container to the main timeline list
        timelineList.appendChild(monthContainer);
    }
}

function appendDetailedPlan(monthsData) {
    monthsData.forEach((data, index) => {
        const monthNumber = index;  
        const monthContainer = document.getElementById(`month-${monthNumber}`);
        if (!monthContainer) {
            console.error("Month container not found for month: ", monthNumber);
            return;
        }
 
        // this clears the existing details list if it is present -> resets + creates new one
        const existingDetailsList = monthContainer.getElementsByClassName('detailed-plan-list');
        while (existingDetailsList.length > 0) {
            existingDetailsList[0].parentNode.removeChild(existingDetailsList[0]);
        }

        // list for the detailedPlan
        const detailsList = document.createElement('ul');
        detailsList.className = 'section-list detailed-plan-list';  // Added class for identification

        const detailsHeader = document.createElement('li');
        detailsHeader.className = 'section-header';
        detailsHeader.textContent = `Detailed Plan`;
        detailsList.appendChild(detailsHeader);

        // splits tasks for each given month, which is separated by a '-'
        console.log("Response data before splitting: ", data);
        const tasks = data.split('-');
        tasks.forEach(task => {
            const taskItem = document.createElement('li');
            taskItem.textContent = task.trim();
            detailsList.appendChild(taskItem);
        });

        // this adds each month's given tasks 
        monthContainer.appendChild(detailsList);
    });
    // shows the undo button
    document.getElementById('undoButton').style.display = 'block';

}

// function that handles the undo button functionality
function undoDetailedPlan(){ 
  const detailedLists = document.getElementsByClassName('detailed-plan-list');
  Array.from(detailedLists).forEach(list => list.parentNode.removeChild(list));

  // removes the current detailedPlans from local storage
  localStorage.removeItem('detailedPlans');

  // hides undo button
  document.getElementById('undoButton').style.display = 'none';
}

// adds loading screen/buffer for when the detailedPlan
function showLoad(display) {
  const modal = document.getElementById('myModal');
  modal.style.display = display ? 'block' : 'none';
}

// enables dark mode
function toggleDarkMode() {
    var currentTheme = document.body.getAttribute('data-theme');
    var newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    document.body.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme); // Save the theme preference
  }
</script>
</body>
</html>
