<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Career Track Timeline</title>
<style>
  body {
    font-family: Arial, sans-serif;
  }
  .active-nav {
    font-weight: bold;
  }
  .mytrack-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
  }
  .mytrack-nav {
    list-style-type: none;
    padding: 0;
  }
  .mytrack-nav li {
    display: inline;
    margin-right: 20px;
  }
  .mytrack-nav a {
    display: inline-block;
    text-decoration:none;
    color: #333;
    background-color: #e7e7e7;
    border: none;
    padding: 10px 20px;
    margin-right: 10px;
    border-radius: 5px;
    transition: background-color 0.3s;
  }
  .mytrack-nav a:hover {
    background-color: #ddd;
  }
  #timelineList, #dedicationForm {
    list-style-type: none;
    padding: 0;
    margin: 20px 0;
  }
  .month-container {
    flex: 1 1 33%;
    padding: 10px;
    box-sizing: border-box;
    border: 1px solid #ddd;
    margin-bottom: 20px;
  }
  .timeline-row {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
  }
  .month-header {
    background-color: #f2f2f2;
    padding: 10px;
    font-size: 1.2em;
    color: #333;
    margin-bottom: 5px;
  }
  .section-header {
    font-weight: bold;
    padding-top: 10px;
  }
  .section-list {
    list-style-type: circle;
    margin-left: 20px;
  }
</style>
</head>
<body>

<div class="mytrack-header">
  <h1>My Track Career Timeline</h1>
  <ul class="mytrack-nav">
    <li><a href="dashboard.html">Dashboard</a></li>
    <li><a href="jobs.html">Jobs</a></li>
    <li><a href="courses.html">Courses</a></li>
    <li><a href="mytrack.html" class="active-nav">MyTrack</a></li>
    <li><a href="profile.html">Profile</a></li>
  </ul>
</div>
<div id="timelineDisplay">
  <h2>Career Track Timeline</h2>
  <div id="timelineList" class="timeline-row"></div>
  <button class="plan-button" onclick="setDedication()">Generate a More Detailed Plan</button>
  <div id="timelineList" class="timeline-row"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    buildTimeline();
});

let dailyHours = parseInt(localStorage.getItem('dailyHours')) || 0; 
let selectedItems1 = JSON.parse(localStorage.getItem('selectedItems1')) || [];
let skillTimeFrames = JSON.parse(localStorage.getItem('skillTimeFrames')) || {};
let maxSkillDuration = Math.max(0, ...Object.values(skillTimeFrames));


async function setDedication() {
    await postData(selectedItems1, skillTimeFrames, dailyHours, maxSkillDuration);
    buildTimeline();
}

async function postData(selectedItems1, skillTimeFrames, dailyHours, maxSkillDuration) {
  // converts skillTimeFrames (js object) -> readable string by GPT when passed in 
  function formatSkillsReadable(skillTimeFrames) {
    let readableString = "";
    let index = 0; 
    for (let skill in skillTimeFrames) {
      if (skillTimeFrames.hasOwnProperty(skill)) { // check if the key is actually a property of the object
        index++;
        readableString += `${index}. Skill: ${skill}, Timeframe: ${skillTimeFrames[skill]}\n`;
      }
    }
    return readableString;
  }

  const readableSkills = formatSkillsReadable(skillTimeFrames);

  const response = await fetch('https://noggin.rea.gent/dusty-cougar-8520', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      Authorization: 'Bearer rg_v1_5jgy6smbvfqh3rswwh1a9bdalypw7rq7ebf7_ngk',
    },
    body: JSON.stringify({
      "skills": selectedItems1,
      "desiredskills": readableSkills,
      "hours": dailyHours,
      "months": maxSkillDuration,
    }),
  }).then(response => response.text());

  return response;
}

function buildTimeline() {
    const timelineList = document.getElementById("timelineList");
    timelineList.innerHTML = "";
    for (let month = 1; month <= maxSkillDuration; month++) {
        const monthContainer = document.createElement('div');
        monthContainer.className = 'month-container';

        const monthHeader = document.createElement('div');
        monthHeader.className = 'month-header';
        monthHeader.textContent = `Month ${month}`;
        monthContainer.appendChild(monthHeader);
        
        const applyList = document.createElement('ul');
        applyList.className = 'section-list';
        const applyHeader = document.createElement('li');
        applyHeader.className = 'section-header';
        applyHeader.textContent = 'Apply';
        applyList.appendChild(applyHeader);

        const takeList = document.createElement('ul');
        takeList.className = 'section-list';
        const takeHeader = document.createElement('li');
        takeHeader.className = 'section-header';
        takeHeader.textContent = 'Take';
        takeList.appendChild(takeHeader);

        selectedItems1.forEach(skill => {
            const task = document.createElement('li');
            task.textContent = skill;
            applyList.appendChild(task);
        });

        for (let skill in skillTimeFrames) {
            const task = document.createElement('li');
            if (month <= skillTimeFrames[skill]) {
                task.textContent = skill;
                takeList.appendChild(task);
            } else if (skillTimeFrames[skill] > 0) {
                task.textContent = skill;
                applyList.appendChild(task);
            }
        }

        if (applyList.childNodes.length > 1) {
            monthContainer.appendChild(applyList);
        }
        if (takeList.childNodes.length > 1) {
            monthContainer.appendChild(takeList);
        }

        timelineList.appendChild(monthContainer);
    }
}

</script>
</body>
</html>
