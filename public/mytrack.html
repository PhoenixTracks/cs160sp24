<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Career Track Timeline</title>
<link rel="icon" type="image/x-icon" href="/images/icon.ico">
<style>
  body {
    font-family: Arial, sans-serif;
  }
  .active-nav {
    font-weight: bold;
  }
  .mytrack-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
  }
  .mytrack-nav {
    list-style-type: none;
    padding: 0;
  }
  .mytrack-nav li {
    display: inline;
    margin-right: 20px;
  }
  .mytrack-nav a {
    display: inline-block;
    text-decoration:none;
    color: #333;
    background-color: #e7e7e7;
    border: none;
    padding: 10px 20px;
    margin-right: 10px;
    border-radius: 5px;
    transition: background-color 0.3s;
  }
  .mytrack-nav a:hover {
    background-color: #ddd;
  }
  #timelineList, #dedicationForm {
    list-style-type: none;
    padding: 0;
    margin: 20px 0;
  }
  .month-container {
    flex: 1 1 33%;
    padding: 10px;
    box-sizing: border-box;
    border: 1px solid #ddd;
    margin-bottom: 20px;
    background-color: #fff;
    margin-right: 20px;  /* Adds horizontal space between containers */
    margin-bottom: 20px;  /* Adds vertical space between container rows */
  }
  .timeline-row {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
  }
  .month-header {
    background-color: #f2f2f2;
    padding: 10px;
    font-size: 1.2em;
    color: #333;
    margin-bottom: 5px;
  }
  .section-header {
    font-weight: bold;
    list-style-type: none;
    padding-top: 10px;
    padding-bottom: 10px;
    padding-left: 0;
    margin-left: 0;
    margin: 0 -10px;  /* Extend the header to the full width of the container */
    background-color: #e7e7e7; /* Light grey background for visibility */
    border-radius: 5px; /* Optional rounded corners for aesthetic */
  }
  .section-list {
    list-style-type: circle;
    margin-left: 20px;
    padding-left: 0;
  }
  #buttonContainer {
  display: flex;
  justify-content: center; /* Center buttons horizontally */
  align-items: center; /* Center buttons vertically if needed */
  gap: 10px; /* Spacing between buttons */
  }

  .plan-button, #undoButton {
    padding: 10px 20px;
    font-size: 16px;
    color: white;
    background-color: #4CAF50; /* Green background for visibility */
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  .plan-button:hover, #undoButton:hover {
    background-color: #45a049; /* Slightly darker green on hover */
  }

  #undoButton {
    background-color: #f44336; /* Red background for the undo button */
  }

  #undoButton:hover {
    background-color: #d32f2f; /* Slightly darker red on hover */
  }


  /* loader source code: https://www.sliderrevolution.com/resources/css-loaders/  */
  .loader  {
  animation: rotate 1s infinite;  
  height: 50px;
  width: 50px;
  position: fixed;
  left: 50%;
  top: 34%;
  transform: translate(-50%, -50%); /* centers loader to be middle of page */
  z-index: 1000; 
}
.loader:before,
.loader:after {   
  border-radius: 50%;
  content: '';
  display: block;
  height: 20px;  
  width: 20px;
}
.loader:before {
  animation: ball1 1s infinite;  
  background-color: #cb2025;
  box-shadow: 30px 0 0 #f8b334;
  margin-bottom: 10px;
}
.loader:after {
  animation: ball2 1s infinite; 
  background-color: #00a096;
  box-shadow: 30px 0 0 #97bf0d;
}

@keyframes rotate {
  0% { 
    -webkit-transform: rotate(0deg) scale(0.8); 
    -moz-transform: rotate(0deg) scale(0.8);
  }
  50% { 
    -webkit-transform: rotate(360deg) scale(1.2); 
    -moz-transform: rotate(360deg) scale(1.2);
  }
  100% { 
    -webkit-transform: rotate(720deg) scale(0.8); 
    -moz-transform: rotate(720deg) scale(0.8);
  }
}

@keyframes ball1 {
  0% {
    box-shadow: 30px 0 0 #f8b334;
  }
  50% {
    box-shadow: 0 0 0 #f8b334;
    margin-bottom: 0;
    -webkit-transform: translate(15px,15px);
    -moz-transform: translate(15px, 15px);
  }
  100% {
    box-shadow: 30px 0 0 #f8b334;
    margin-bottom: 10px;
  }
}

@keyframes ball2 {
  0% {
    box-shadow: 30px 0 0 #97bf0d;
  }
  50% {
    box-shadow: 0 0 0 #97bf0d;
    margin-top: -20px;
    -webkit-transform: translate(15px,15px);
    -moz-transform: translate(15px, 15px);
  }
  100% {
    box-shadow: 30px 0 0 #97bf0d;
    margin-top: 0;
  }
}
/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

</style>
</head>
<body>

<div class="mytrack-header">
  <h1>My Track Career Timeline</h1>
  <ul class="mytrack-nav">
    <li><a href="dashboard.html">Dashboard</a></li>
    <li><a href="jobs.html">Jobs</a></li>
    <li><a href="courses.html">Courses</a></li>
    <li><a href="mytrack.html" class="active-nav">MyTrack</a></li>
    <li><a href="profile.html">Profile</a></li>
  </ul>
</div>
<div id="timelineDisplay"> 
  <h2>Career Track Timeline</h2>
  <div id="buttonContainer" style="margin-top: 20px;">
    <button class="plan-button" onclick="setDedication()">Generate a More Detailed Plan</button>
    <button id="undoButton" style="display: none;" onclick="undoDetailedPlan()">Undo Detailed Plan</button>
  </div>
  <div id="timelineList" class="timeline-row"></div>
  <!-- this is a loading spinner/circle as we wait for detailedPlan to show up -->
  <div id="loadingIndicator" style="display: none;" class="loader">
  </div>
  <!-- loading message -->
  <div id="loadingModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <p>Generating your detailed plan...</p>
    </div>
  </div>

</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    buildTimeline();
    loadDetailedPlans();
});
function loadDetailedPlans() {
    const storedPlans = localStorage.getItem('detailedPlans');
    if (storedPlans) {
        const monthsData = JSON.parse(storedPlans);
        appendDetailedPlan(monthsData);
    }
}

let dailyHours = parseInt(localStorage.getItem('dailyHours')) || 0; 
let selectedItems1 = JSON.parse(localStorage.getItem('selectedItems1')) || [];
let skillTimeFrames = JSON.parse(localStorage.getItem('skillTimeFrames')) || {};
let maxSkillDuration = Math.max(0, ...Object.values(skillTimeFrames));


async function setDedication() {
    showLoad(true); // loading circle shows
    const response = await postData(selectedItems1, skillTimeFrames, dailyHours, maxSkillDuration);
    const monthsData = response.split('^');
    localStorage.setItem('detailedPlans', JSON.stringify(monthsData));
    appendDetailedPlan(monthsData);
    showLoad(false); // loading circle goes away
    
}

async function postData(selectedItems1, skillTimeFrames, dailyHours, maxSkillDuration) {
  // converts skillTimeFrames (js object) -> readable string by GPT when passed in 
  function formatSkillsReadable(skillTimeFrames) {
    let readableString = "";
    let index = 0; 
    for (let skill in skillTimeFrames) {
      if (skillTimeFrames.hasOwnProperty(skill)) { // check if the key is actually a property of the object
        index++;
        readableString += `${index}. Skill: ${skill}, Timeframe: ${skillTimeFrames[skill]}\n`;
      }
    }
    return readableString;
  }

  const readableSkills = formatSkillsReadable(skillTimeFrames);
  // import fetch from 'node-fetch'; // for node.js

  // claude test noggin
  const response = await fetch(
    'https://noggin.rea.gent/criminal-rooster-5479',
    {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: 'Bearer rg_v1_bpuldd2dy138fzuj519iszhurqp93zuhrl1h_ngk',
      },
      body: JSON.stringify({
        // fill variables here.
        "skills": selectedItems1,
        "desiredskills": readableSkills,
        "hours": dailyHours,
        "months": maxSkillDuration,
      }),
    }
  ).then(response => response.text());

  // gpt noggin -> used for demos
  //const response = await fetch(
  //'https://noggin.rea.gent/yelling-sawfish-8024',
  //{
    //method: 'POST',
    //headers: {
      //'Content-Type': 'application/json',
      //Authorization: 'Bearer rg_v1_x9wvoyd5m0mqrmcklv5le44vs6rmwrum6dj7_ngk',
    //},
    //body: JSON.stringify({
      // fill variables here.
      //"skills": selectedItems1,
      //"desiredskills": readableSkills,
      //"hours": dailyHours,
      //"months": maxSkillDuration,
    //}),
  //}
//).then(response => response.text());
    return response;
}

function buildTimeline() {
    const timelineList = document.getElementById("timelineList");
    timelineList.innerHTML = ""; 

    for (let month = 1; month <= maxSkillDuration; month++) {
        
        const monthContainer = document.createElement('div');
        monthContainer.className = 'month-container';
        monthContainer.id = `month-${month}`; 

        const monthHeader = document.createElement('div');
        monthHeader.className = 'month-header';
        monthHeader.textContent = `Month ${month}`;
        monthContainer.appendChild(monthHeader);

        const applyList = document.createElement('ul');
        applyList.className = 'section-list';
        const applyHeader = document.createElement('li');
        applyHeader.className = 'section-header';
        applyHeader.textContent = 'Apply to Jobs Related to these Skills';
        applyList.appendChild(applyHeader);
        
        const takeList = document.createElement('ul');
        takeList.className = 'section-list';
        const takeHeader = document.createElement('li');
        takeHeader.className = 'section-header';
        takeHeader.textContent = 'Take & Continue These Courses';
        takeList.appendChild(takeHeader);

        selectedItems1.forEach(skill => {
            const task = document.createElement('li');
            task.textContent = skill; 
            applyList.appendChild(task); 
        });

        
        for (let skill in skillTimeFrames) {
            const task = document.createElement('li');
            if (month <= skillTimeFrames[skill]) {
                task.textContent = skill; // skill active within this month
                takeList.appendChild(task);
            } else if (skillTimeFrames[skill] > 0) {
                task.textContent = skill;
                applyList.appendChild(task); // skill needs applying after active period
            }
        }

        // appends apply and take lists to the month container if not empty
        if (applyList.children.length > 1) {
            monthContainer.appendChild(applyList);
        }
        if (takeList.children.length > 1) {
            monthContainer.appendChild(takeList);
        }

        // appends the month container to the main timeline list
        timelineList.appendChild(monthContainer);
    }
}

function appendDetailedPlan(monthsData) {
    monthsData.forEach((data, index) => {
        const monthNumber = index;  
        const monthContainer = document.getElementById(`month-${monthNumber}`);
        if (!monthContainer) {
            console.error("Month container not found for month: ", monthNumber);
            return;
        }
 
        // this clears the existing details list if it is present -> resets + creates new one
        const existingDetailsList = monthContainer.getElementsByClassName('detailed-plan-list');
        while (existingDetailsList.length > 0) {
            existingDetailsList[0].parentNode.removeChild(existingDetailsList[0]);
        }

        // list for the detailedPlan
        const detailsList = document.createElement('ul');
        detailsList.className = 'section-list detailed-plan-list';  // Added class for identification

        const detailsHeader = document.createElement('li');
        detailsHeader.className = 'section-header';
        detailsHeader.textContent = `Detailed Plan`;
        detailsList.appendChild(detailsHeader);

        // splits tasks for each given month, which is separated by a '-'
        console.log("Response data before splitting: ", data);
        const tasks = data.split('-');
        tasks.forEach(task => {
            const taskItem = document.createElement('li');
            taskItem.textContent = task.trim();
            detailsList.appendChild(taskItem);
        });

        // this adds each month's given tasks 
        monthContainer.appendChild(detailsList);
    });
    // shows the undo button
    document.getElementById('undoButton').style.display = 'block';

}

// function that handles the undo button functionality
function undoDetailedPlan(){ 
  const detailedLists = document.getElementsByClassName('detailed-plan-list');
  Array.from(detailedLists).forEach(list => list.parentNode.removeChild(list));

  // removes the current detailedPlans from local storage
  localStorage.removeItem('detailedPlans');

  // hides undo button
  document.getElementById('undoButton').style.display = 'none';
}

// adds loading screen/buffer for when the detailedPlan
function showLoad(display) {
  document.getElementById('loadingIndicator').style.display = display ? 'flex' : 'none';
}


</script>
</body>
</html>
